<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>再利用可能な電子回路部品ライブラリ</title>
	<style>
		body {
			font-family: 'Arial', sans-serif;
			margin: 0;
			padding: 20px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			color: #333;
		}

		.container {
			max-width: 1400px;
			margin: 0 auto;
			background: white;
			border-radius: 20px;
			box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
			padding: 40px;
		}

		h1 {
			text-align: center;
			color: #2c3e50;
			margin-bottom: 30px;
			font-size: 2.5em;
			text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
		}

		.toolbar {
			display: flex;
			flex-wrap: wrap;
			gap: 15px;
			margin-bottom: 30px;
			padding: 20px;
			background: #f8f9fa;
			border-radius: 15px;
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
		}

		.component-controls {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
			align-items: center;
		}

		.btn {
			background: linear-gradient(135deg, #3498db, #2980b9);
			color: white;
			border: none;
			padding: 10px 20px;
			border-radius: 25px;
			cursor: pointer;
			font-size: 14px;
			transition: all 0.3s ease;
			box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
		}

		.btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
		}

		.btn.secondary {
			background: linear-gradient(135deg, #95a5a6, #7f8c8d);
			box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3);
		}

		.btn.danger {
			background: linear-gradient(135deg, #e74c3c, #c0392b);
			box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
		}

		.input-group {
			display: flex;
			gap: 10px;
			align-items: center;
		}

		input,
		select {
			padding: 8px 12px;
			border: 2px solid #ddd;
			border-radius: 8px;
			font-size: 14px;
			transition: border-color 0.3s ease;
		}

		input:focus,
		select:focus {
			outline: none;
			border-color: #3498db;
		}

		.canvas-area {
			background: white;
			border: 2px solid #ddd;
			border-radius: 15px;
			margin-bottom: 30px;
			min-height: 400px;
			position: relative;
			overflow: auto;
		}

		#circuitCanvas {
			width: 100%;
			height: 400px;
			cursor: crosshair;
		}

		.library-panel {
			background: #f8f9fa;
			border-radius: 15px;
			padding: 25px;
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
		}

		.library-title {
			font-size: 1.4em;
			font-weight: bold;
			margin-bottom: 20px;
			color: #2c3e50;
		}

		.library-items {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
			gap: 15px;
		}

		.library-item {
			background: white;
			border-radius: 10px;
			padding: 15px;
			box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
			transition: transform 0.3s ease;
		}

		.library-item:hover {
			transform: translateY(-3px);
		}

		.library-item-name {
			font-weight: bold;
			margin-bottom: 5px;
			color: #2c3e50;
		}

		.library-item-type {
			font-size: 0.9em;
			color: #666;
			margin-bottom: 10px;
		}

		.library-item-actions {
			display: flex;
			gap: 8px;
		}

		.status-bar {
			background: #2c3e50;
			color: white;
			padding: 10px 20px;
			border-radius: 10px;
			margin-top: 20px;
			font-family: monospace;
		}

		.modal {
			display: none;
			position: fixed;
			z-index: 1000;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5);
		}

		.modal-content {
			background-color: white;
			margin: 15% auto;
			padding: 30px;
			border-radius: 15px;
			width: 80%;
			max-width: 500px;
			box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
		}

		.modal h3 {
			margin-top: 0;
			color: #2c3e50;
		}

		textarea {
			width: 100%;
			height: 200px;
			padding: 10px;
			border: 2px solid #ddd;
			border-radius: 8px;
			font-family: monospace;
			font-size: 12px;
			resize: vertical;
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>再利用可能な電子回路部品ライブラリ</h1>

		<div class="toolbar">
			<div class="component-controls">
				<button class="btn" onclick="addResistor()">抵抗器追加</button>
				<button class="btn" onclick="addInductor()">インダクタ追加</button>
				<button class="btn" onclick="addCapacitor()">コンデンサ追加</button>

				<div class="input-group">
					<label>値:</label>
					<input type="text" id="componentValue" placeholder="例: 100Ω" value="">
				</div>

				<div class="input-group">
					<label>回転:</label>
					<select id="rotationSelect">
						<option value="0">0°</option>
						<option value="90">90°</option>
						<option value="180">180°</option>
						<option value="270">270°</option>
					</select>
				</div>
			</div>

			<div class="component-controls">
				<button class="btn secondary" onclick="clearCanvas()">クリア</button>
				<button class="btn secondary" onclick="saveCurrentComponent()">部品保存</button>
				<button class="btn secondary" onclick="showExportModal()">エクスポート</button>
				<button class="btn secondary" onclick="showImportModal()">インポート</button>
			</div>
		</div>

		<div class="canvas-area">
			<svg id="circuitCanvas" viewBox="0 0 1200 400">
				<!-- グリッド -->
				<defs>
					<pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
						<path d="M 20 0 L 0 0 0 20" fill="none" stroke="#eee" stroke-width="1" />
					</pattern>
				</defs>
				<rect width="100%" height="100%" fill="url(#grid)" />
			</svg>
		</div>

		<div class="library-panel">
			<div class="library-title">保存された部品ライブラリ</div>
			<div class="library-items" id="libraryItems">
				<!-- 保存された部品がここに表示されます -->
			</div>
		</div>

		<div class="status-bar" id="statusBar">
			マウスでクリックして部品を配置してください。
		</div>
	</div>

	<!-- エクスポートモーダル -->
	<div id="exportModal" class="modal">
		<div class="modal-content">
			<h3>部品ライブラリのエクスポート</h3>
			<p>以下のJSONデータをコピーして保存してください：</p>
			<textarea id="exportData" readonly></textarea>
			<div style="margin-top: 15px; text-align: right;">
				<button class="btn secondary" onclick="closeModal('exportModal')">閉じる</button>
				<button class="btn" onclick="copyExportData()">コピー</button>
			</div>
		</div>
	</div>

	<!-- インポートモーダル -->
	<div id="importModal" class="modal">
		<div class="modal-content">
			<h3>部品ライブラリのインポート</h3>
			<p>JSONデータを貼り付けてください：</p>
			<textarea id="importData" placeholder="JSONデータをここに貼り付け..."></textarea>
			<div style="margin-top: 15px; text-align: right;">
				<button class="btn secondary" onclick="closeModal('importModal')">キャンセル</button>
				<button class="btn" onclick="importLibrary()">インポート</button>
			</div>
		</div>
	</div>

	<script src="circuit-components.js"></script>
	<script>
		// グローバル変数
		let circuitDiagram;
		let componentLibrary;
		let componentCounter = 0;
		let selectedComponentType = 'resistor';
		let clickPosition = { x: 100, y: 200 };

		// 初期化
		document.addEventListener('DOMContentLoaded', function () {
			const canvas = document.getElementById('circuitCanvas');
			circuitDiagram = new CircuitComponents.CircuitDiagram(canvas);
			componentLibrary = new CircuitComponents.ComponentLibrary();

			// キャンバスクリックイベント
			canvas.addEventListener('click', function (event) {
				const rect = canvas.getBoundingClientRect();
				const x = (event.clientX - rect.left) * (canvas.viewBox.baseVal.width / rect.width);
				const y = (event.clientY - rect.top) * (canvas.viewBox.baseVal.height / rect.height);

				clickPosition = { x, y };
				addComponentAtPosition(x, y);
			});

			updateLibraryDisplay();
			updateStatus('初期化完了。クリックして部品を配置してください。');
		});

		function addComponentAtPosition(x, y) {
			const value = document.getElementById('componentValue').value || getDefaultValue();
			const rotation = parseInt(document.getElementById('rotationSelect').value);
			let component;

			switch (selectedComponentType) {
				case 'resistor':
					component = new CircuitComponents.Resistor(x, y, rotation, value);
					break;
				case 'inductor':
					component = new CircuitComponents.Inductor(x, y, rotation, value);
					break;
				case 'capacitor':
					component = new CircuitComponents.Capacitor(x, y, rotation, value);
					break;
			}

			if (component) {
				const id = `comp_${++componentCounter}`;
				circuitDiagram.addComponent(component, id);
				updateStatus(`${selectedComponentType}を追加しました (${value}) at (${Math.round(x)}, ${Math.round(y)})`);
			}
		}

		function addResistor() {
			selectedComponentType = 'resistor';
			document.getElementById('componentValue').placeholder = '例: 100Ω';
			updateStatus('抵抗器モードに切り替えました。クリックして配置してください。');
		}

		function addInductor() {
			selectedComponentType = 'inductor';
			document.getElementById('componentValue').placeholder = '例: 10mH';
			updateStatus('インダクタモードに切り替えました。クリックして配置してください。');
		}

		function addCapacitor() {
			selectedComponentType = 'capacitor';
			document.getElementById('componentValue').placeholder = '例: 100μF';
			updateStatus('コンデンサモードに切り替えました。クリックして配置してください。');
		}

		function getDefaultValue() {
			switch (selectedComponentType) {
				case 'resistor': return 'R';
				case 'inductor': return 'L';
				case 'capacitor': return 'C';
				default: return '';
			}
		}

		function clearCanvas() {
			circuitDiagram.clear();
			updateStatus('キャンバスをクリアしました。');
		}

		function saveCurrentComponent() {
			const name = prompt('部品に名前を付けてください:');
			if (!name) return;

			const value = document.getElementById('componentValue').value || getDefaultValue();
			const rotation = parseInt(document.getElementById('rotationSelect').value);
			let component;

			switch (selectedComponentType) {
				case 'resistor':
					component = new CircuitComponents.Resistor(0, 0, rotation, value);
					break;
				case 'inductor':
					component = new CircuitComponents.Inductor(0, 0, rotation, value);
					break;
				case 'capacitor':
					component = new CircuitComponents.Capacitor(0, 0, rotation, value);
					break;
			}

			if (component) {
				componentLibrary.saveComponent(name, component);
				updateLibraryDisplay();
				updateStatus(`部品 "${name}" を保存しました。`);
			}
		}

		function loadComponentFromLibrary(name) {
			const component = componentLibrary.loadComponent(name);
			if (component) {
				component.x = clickPosition.x;
				component.y = clickPosition.y;
				const id = `comp_${++componentCounter}`;
				circuitDiagram.addComponent(component, id);
				updateStatus(`ライブラリから "${name}" を読み込みました。`);
			}
		}

		function deleteFromLibrary(name) {
			if (confirm(`"${name}" を削除しますか？`)) {
				componentLibrary.deleteComponent(name);
				updateLibraryDisplay();
				updateStatus(`部品 "${name}" を削除しました。`);
			}
		}

		function updateLibraryDisplay() {
			const container = document.getElementById('libraryItems');
			container.innerHTML = '';

			const components = componentLibrary.listComponents();
			if (components.length === 0) {
				container.innerHTML = '<p style="text-align: center; color: #666;">保存された部品がありません</p>';
				return;
			}

			components.forEach(name => {
				const data = componentLibrary.savedComponents[name];
				const item = document.createElement('div');
				item.className = 'library-item';
				item.innerHTML = `
                    <div class="library-item-name">${name}</div>
                    <div class="library-item-type">${data.type} (${data.value || '値なし'})</div>
                    <div class="library-item-actions">
                        <button class="btn" style="font-size: 12px; padding: 5px 10px;" onclick="loadComponentFromLibrary('${name}')">読み込み</button>
                        <button class="btn danger" style="font-size: 12px; padding: 5px 10px;" onclick="deleteFromLibrary('${name}')">削除</button>
                    </div>
                `;
				container.appendChild(item);
			});
		}

		function showExportModal() {
			const exportData = componentLibrary.exportComponents();
			document.getElementById('exportData').value = exportData;
			document.getElementById('exportModal').style.display = 'block';
		}

		function showImportModal() {
			document.getElementById('importData').value = '';
			document.getElementById('importModal').style.display = 'block';
		}

		function closeModal(modalId) {
			document.getElementById(modalId).style.display = 'none';
		}

		function copyExportData() {
			const textarea = document.getElementById('exportData');
			textarea.select();
			document.execCommand('copy');
			updateStatus('エクスポートデータをクリップボードにコピーしました。');
		}

		function importLibrary() {
			const importData = document.getElementById('importData').value;
			if (componentLibrary.importComponents(importData)) {
				updateLibraryDisplay();
				closeModal('importModal');
				updateStatus('ライブラリのインポートが完了しました。');
			} else {
				alert('インポートに失敗しました。JSONデータを確認してください。');
			}
		}

		function updateStatus(message) {
			document.getElementById('statusBar').textContent = message;
		}

		// モーダルの外側クリックで閉じる
		window.onclick = function (event) {
			const modals = document.querySelectorAll('.modal');
			modals.forEach(modal => {
				if (event.target === modal) {
					modal.style.display = 'none';
				}
			});
		}
	</script>
</body>

</html>